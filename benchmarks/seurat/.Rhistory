index <- 5
name <- paste(index,"h5seurat",sep="")
print(name)
name <- paste("q", index,"h5seurat",sep="")
print(name)
start.time <- Sys.time()
end.time <- Sys.time()
time.taken.ref <- end.time - start.time
savedir = "~/Documents/seurat_benchmarks/brain/"
fileConn<-file(paste(savedir,"ref_time.txt",sep=""))
writeLines(time.taken.ref, fileConn)
close(fileConn)
print(time.taken.ref)
typeof(time.taken.ref)
print(as.character(time.taken.ref))
fileConn<-file(paste(savedir,"ref_time.txt",sep=""))
writeLines(as.character(time.taken.ref), fileConn)
close(fileConn)
source("~/Documents/tranvae_paper_scripts/seurat/seurat_v4 _vanilla.R")
source("~/Documents/tranvae_paper_scripts/seurat/seurat_v4 _vanilla.R")
source("~/Documents/tranvae_paper_scripts/seurat/seurat_v4 _vanilla.R")
library("Seurat")
library("SeuratDisk")
library("future")
options(future.globals.maxSize = (2000000*1024^2))
nHVGs <- 4000
verbose <- TRUE
ncpu <- 4
dimr <- 150
dimqm <- 50
savedir = "~/Documents/seurat_benchmarks/scvelo/"
datadir <- "~/Documents/benchmarking_datasets/benchmark_scvelo_shrinked.h5ad"
reference <- c('12.5', '13.5')
query <- c('14.5', '15.5')
batch_key <- "study"
ct_key <- "cell_type"
seudatdir <- paste(substr(datadir, 1, nchar(datadir)-4),"h5seurat",sep="")
batches <- c(reference, query)
Convert(datadir, dest= "h5seurat", assay = "RNA", overwrite  = T)
seudata <- LoadH5Seurat(seudatdir, assays = "RNA")
seudata.list <- SplitObject(seudata, split.by = batch_key)
seudata.list <- seudata.list[batches]
for (i in 1:length(seudata.list)) {
seudata.list[[i]] <- NormalizeData(seudata.list[[i]])
seudata.list[[i]] <- FindVariableFeatures(seudata.list[[i]],
selection.method = "vst",
nfeatures = nHVGs)
seudata.list[[i]] <- ScaleData(seudata.list[[i]])
seudata.list[[i]] <- RunPCA(seudata.list[[i]])
}
reference.list <- seudata.list[reference]
query.list <- seudata.list[query]
start.time <- Sys.time()
seudata.anchors <- FindIntegrationAnchors(object.list = reference.list,
reduction = "rpca",
dims = 1:dimr)
